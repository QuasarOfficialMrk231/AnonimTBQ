<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonim TBQ Browser</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #url-bar {
            padding: 10px;
            background: #f1f1f1;
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #ccc;
        }

        #url-input {
            width: 80%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #go-button {
            padding: 5px 10px;
            margin-left: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        iframe {
            width: 100%;
            height: 80vh;
            border: none;
        }

        #warning {
            color: red;
            margin-top: 20px;
        }

        #close-button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #stats {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>–ê–Ω–æ–Ω–∏–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä</h1>

    <div id="url-bar">
        <input type="text" id="url-input" placeholder="–í–≤–µ–¥–∏—Ç–µ URL –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞..." />
        <button id="go-button">–ü–µ—Ä–µ–π—Ç–∏</button>
    </div>

    <iframe id="browser-frame" sandbox="allow-same-origin allow-scripts" title="–ê–Ω–æ–Ω–∏–º–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä"></iframe>

    <p id="warning">–î–ª—è –ø–æ–ª–Ω–æ–π –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN/Tor –∏ –æ—Ç–∫–ª—é—á–∏—Ç—å WebRTC.</p>

    <div id="stats">
        <p>‚è≥ –í—Ä–µ–º—è –Ω–∞ —Å–∞–π—Ç–µ: <span id="time-spent">0</span> —Å–µ–∫.</p>
        <p>üìä –°–∫–æ—Ä–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–∞–π—Ç–æ–º: <span id="ping">0</span> –º—Å</p>
    </div>

    <button id="close-button">–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</button>

    <script>
        const urlInput = document.getElementById('url-input');
        const goButton = document.getElementById('go-button');
        const browserFrame = document.getElementById('browser-frame');
        const closeButton = document.getElementById('close-button');
        const timeSpentElement = document.getElementById('time-spent');
        const pingElement = document.getElementById('ping');

        let timeSpent = 0;
        let timer;

        function anonymizeNavigator() {
            Object.defineProperties(navigator, {
                userAgent: { get: () => "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" },
                platform: { get: () => "Win32" },
                language: { get: () => "en-US" },
                languages: { get: () => ["en-US"] },
                hardwareConcurrency: { get: () => 4 },
                deviceMemory: { get: () => 8 },
                connection: { get: () => ({ effectiveType: "4g", downlink: 10, rtt: 50 }) },
            });

            const originalDate = Date;
            window.Date = class extends originalDate {
                getTimezoneOffset() {
                    return 0;
                }
            };
        }

        function disableWebRTC() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia = () => Promise.reject(new Error("WebRTC –æ—Ç–∫–ª—é—á—ë–Ω."));
            }

            if (window.RTCPeerConnection) {
                window.RTCPeerConnection = function () {
                    throw new Error("WebRTC –æ—Ç–∫–ª—é—á—ë–Ω.");
                };
            }
        }

        function removeReferer() {
            history.replaceState(null, '', '/');
        }

        function formatUrl(input) {
            let url = input.trim();
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            return url;
        }

        function startTimer() {
            timer = setInterval(() => {
                timeSpent++;
                timeSpentElement.textContent = timeSpent;
            }, 1000);
        }

        async function measurePing(url) {
            const start = performance.now();
            try {
                await fetch(url, { mode: 'no-cors' });
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ—Ä–µ–Ω–∏–∏ –ø–∏–Ω–≥–∞:", error);
            }
            const end = performance.now();
            const ping = Math.round(end - start);
            pingElement.textContent = ping;
        }

        goButton.addEventListener('click', () => {
            const url = formatUrl(urlInput.value);
            browserFrame.src = url;

            clearInterval(timer);
            timeSpent = 0;
            startTimer();
            measurePing(url);
        });

        function clearData() {
            if (window.localStorage) localStorage.clear();
            if (window.sessionStorage) sessionStorage.clear();

            document.cookie.split(";").forEach((cookie) => {
                const cookieName = cookie.split("=")[0].trim();
                document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/`;
            });

            if ('caches' in window) {
                caches.keys().then((cacheNames) => {
                    cacheNames.forEach((cacheName) => {
                        caches.delete(cacheName);
                    });
                });
            }

            window.close();
            window.open('https://www.google.com', '_blank');
        }

        closeButton.addEventListener('click', clearData);

        window.onload = () => {
            anonymizeNavigator();
            disableWebRTC();
            removeReferer();
            startTimer();
        };
    </script>

</body>

</html>